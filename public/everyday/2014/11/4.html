<p>最近笔了阿里巴巴的笔试题，有很多细节上的问题需要总结。题目还是不错的</p>
<h2 id="第一题">第一题</h2>
<h3 id="题面">题面</h3>
<p>说出以下函数的作用是？空白区域应该填写什么？</p>
<pre><code class="javascript"><span class="comment">// define  </span>
(<span class="function"><span class="keyword">function</span> <span class="params">(window)</span> {</span>  
    <span class="function"><span class="keyword">function</span> <span class="title">fn</span><span class="params">(str)</span> {</span>  
        <span class="keyword">this</span>.str = str;  
    }  
    fn.prototype.format = <span class="function"><span class="keyword">function</span> <span class="params">()</span> {</span>  
        <span class="keyword">var</span> arg = ______;  
        <span class="keyword">return</span> <span class="keyword">this</span>.str.replace(_______, <span class="function"><span class="keyword">function</span> <span class="params">(a, b)</span> {</span>  
            <span class="keyword">return</span> arg[b] || <span class="string">''</span>;  
        });  
    }  
    window.fn = fn;  
})(window);  
<span class="comment">// use  </span>
(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>  
    <span class="keyword">var</span> t = <span class="keyword">new</span> fn(<span class="string">'&lt;p&gt;&lt;a href="{0}"&gt;{1}&lt;/a&gt;&lt;span&gt;{2}&lt;/span&gt;&lt;/p&gt;'</span>);
    console.log( t.format(<span class="string">'http://www.alibaba.com'</span>, <span class="string">'Alibaba'</span>, <span class="string">'Welcome'</span>) );  
})();
</code></pre>
<h3 id="解答">解答</h3>
<p>看题面就是，类似于写一个模板引擎。将模板里的<code>{1}</code>之类的占位符替换成传给它的参数。所以arg应该就是arguments。但是由于arg不是数组，而是一个类数组对象。所以需要进行一些转换，比较常规的转换方式如下：</p>
<pre><code class="javascript"><span class="keyword">var</span> arg = <span class="built_in">Array</span>.prototype.slice.call(<span class="built_in">arguments</span>, <span class="number">0</span>);
</code></pre>
<p>等号右边也就是第一空的答案了</p>
<p>第二空则是要通过正则找出占位符，并根据占位符内的数字将其替换成arg数组内的字符串，说实话replace方法的第二个参数为函数的情况很少遇到，这里就是考的这个，最初想法是直接用全局正则匹配一下：</p>
<pre><code class="javascript"><span class="keyword">return</span> <span class="keyword">this</span>.str.replace(<span class="regexp">/\{\d+\}/g</span>, <span class="function"><span class="keyword">function</span> <span class="params">(a, b)</span> {</span>  
    <span class="keyword">return</span> arg[b] || <span class="string">''</span>;  
});
</code></pre>
<p>这样，但是穿进去之后发现不太对，因为b参数是正则匹配到的字符串在完整字符串中的位置。于是去查了一下W3C：</p>
<blockquote>
<p>该函数的第一个参数是匹配模式的字符串。接下来的参数是与模式中的子表达式匹配的字符串，可以有 0 个或多个这样的参数。接下来的参数是一个整数，声明了匹配在 stringObject 中出现的位置。最后一个参数是 stringObject 本身。</p>
</blockquote>
<p>这里显然是因为没有子表达式，所以直接b成了声明的匹配在stringObject中出现的位置。这样就好说了，与模式中字表达式匹配，那加一个子表达式进去，变成这样：</p>
<pre><code class="javascript"><span class="keyword">return</span> <span class="keyword">this</span>.str.replace(<span class="regexp">/\{(\d+)\}/g</span>, <span class="function"><span class="keyword">function</span> <span class="params">(a, b)</span> {</span>  
    <span class="keyword">return</span> arg[b] || <span class="string">''</span>;  
});
</code></pre>
<p>跑一下，齐活，输出<code>&lt;p&gt;&lt;a href=&quot;http://www.alibaba.com&quot;&gt;Alibaba&lt;/a&gt;&lt;span&gt;Welcome&lt;/span&gt;&lt;/p&gt;</code></p>
<h2 id="第二题">第二题</h2>
<h3 id="题面-1">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/9.png" alt="第二题题面"></p>
<h3 id="解答-1">解答</h3>
<p>这题由于时间不太够，就没有写可执行代码，主要是涉及cookie操作。可以分成用户第一次进入检测，用户点击我知道了检测两个行为来分别处理：</p>
<p>第一次进入的时候，首先判断cookie中是否有今天已来过标记，没有记录就写进一个标记，同时由于同一天不显示，所以这个写入带标记的cookie的过期时间应该为1天，这里标记为visited：</p>
<pre><code class="javascript"><span class="keyword">if</span>(document.cookie.indexOf(visited) === -<span class="number">1</span>){
    document.cookie = <span class="string">'visited='</span> + <span class="built_in">escape</span>(<span class="string">'1'</span>) + <span class="string">';expires='</span> + <span class="keyword">new</span> <span class="built_in">Date</span>((<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() + <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>)).toGMTString();
    showTips();
}
</code></pre>
<p>点不再访问的时候，应该运行如下代码：</p>
<pre><code class="javascript">document.cookie = <span class="string">'visited='</span> + <span class="built_in">escape</span>(<span class="string">'1'</span>) + <span class="string">';expires='</span> + <span class="keyword">new</span> <span class="built_in">Date</span>((<span class="keyword">new</span> <span class="built_in">Date</span>().getTime() +  <span class="number">100</span> * <span class="number">365</span> * <span class="number">24</span> * <span class="number">3600</span> * <span class="number">1000</span>)).toGMTString();
</code></pre>
<p>这样设定一个100年才过期的cookie，就相当于永久不显示了</p>
<h2 id="第三题">第三题</h2>
<h3 id="题面-2">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/10.png" alt="第3题题面"></p>
<h3 id="解答-2">解答</h3>
<p>在ul的li上绑点击事件，典型的事件代理的题，要输出index，所以需要提前进行一些提前处理：</p>
<pre><code class="javascript">(<span class="function"><span class="keyword">function</span><span class="params">()</span>{</span>
    <span class="keyword">var</span> nav = document.getElementById(<span class="string">"nav"</span>);
    <span class="keyword">var</span> liList = nav.children;

    <span class="function"><span class="keyword">function</span> <span class="title">bindEvent</span><span class="params">(ele, event, callback)</span> {</span>
        <span class="keyword">if</span> (ele.attachEvent) {
            ele.attachEvent(<span class="string">"on"</span> + event, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> {</span>
                event = event || window.event;
                event.target = event.target || event.srcElement;
                callback(event);
            });
        } <span class="keyword">else</span> {
            ele.addEventListener(event, callback, <span class="literal">false</span>);
        }
    };

    bindEvent(nav, <span class="string">"click"</span>, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> {</span>
        <span class="keyword">var</span> target = event.target;
        <span class="keyword">var</span> a;
        <span class="keyword">var</span> i, m;
        <span class="keyword">if</span> (target.tagName.toLowerCase() === <span class="string">"li"</span>) {
            a = target.children[<span class="number">0</span>];
            <span class="keyword">for</span> (i = <span class="number">0</span>, m = liList.length; i &lt; m; i++) {
                <span class="keyword">if</span> (liList[i] === event.target) {
                    console.log(i + <span class="number">1</span>);
                    console.log(a.getAttribute(<span class="string">"href"</span>));
                    console.log(a.innerText);
                }
            }
        }
    });
}());
</code></pre>
<p>这个事件代理的思想就是，在ul上采用冒泡机制绑定点击事件，在回调函数中使用event.target(IE底下会说)判断是否是li节点，如果是，则输出需要的数字</p>
<p>这里说要支持（该死的）IE，于是多了好几个点：</p>
<ul>
<li>IE的事件绑定需要用attachEvent，而不能直接用addEventListener，所以需要额外处理</li>
<li>老版本的event不是又函数传入，而是写在window里面，所以也需要做一个兼容</li>
<li>老版本的IE中，并没有event.target，所以取而代之的是event.srcElement</li>
<li>IE6、7、8使用数组的slice方法会报错，同时也无法使用indexOf，所以要么把这两个方法重新实现，要么直接通过遍历的方式来处理，我这里直接采用遍历的方式（因为重新实现代码加长很多）</li>
<li>去死吧IE</li>
</ul>
<h2 id="第四题">第四题</h2>
<h3 id="题面-3">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/11.png" alt="第4题题面"></p>
<h3 id="解答-3">解答</h3>
<p>妈蛋被坑了，没看到还要写出其框内内容，写了个绝对定位就交了，呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵呵</p>
<p>及其简单的绝对定位题，里面的内容分成两块，一块是左边的二维码，一块是右边的文字部分。左边浮动，右边触发bfc</p>
<iframe width="100%" height="600" src="http://jsfiddle.net/skyinlayer/27hGA/1/embedded/result,html,css" allowfullscreen="allowfullscreen" frameborder="0">&nbsp;</iframe>

<h2 id="第五题">第五题</h2>
<h3 id="题面-4">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/12.png" alt="第5题题面"></p>
<h3 id="解答-4">解答</h3>
<p>这题是作文…完全答不全，这里的答案不一定对，都是网上摘抄的</p>
<p>可以分成两个部分进行阐述： 1. http连接建立  2.对网页及其资源进行请求</p>
<p>http建立经过如下步骤：</p>
<ol>
<li>浏览器获得url后，对其通过DNS进行解析，转换成ip地址，以及添加上响应的端口（如果没有显式指定，默认80）</li>
<li>浏览器通过三步握手与这个服务器建立TCP连接</li>
<li>在连接建立后，发送一个HTTP请求报文，里面包含了请求的资源的URL，请求方法，参数等等信息</li>
<li>服务器接收到请求报文后进行处理，返回一个包含请求资源内容的响应报文</li>
<li>浏览器关闭这个TCP连接（在HTTP1.1中不会进行关闭，除非进行显式的connection=close，而HTTP1.0中，则会关闭，可以通过keepAlive指定不关闭）</li>
</ol>
<p>对网页的资源请求：</p>
<ol>
<li>浏览器的url框获得url后，通过上述的方式获得HTML文档，获得完成后触发document.onload事件</li>
<li>解析HTML文档，然后按照HTML文档结构从上往下开始请求资源（批量4-8）</li>
<li>请求CSS样式表，当样式表到来的时候，将会拿它和之前已经到来的样式表进行合并和解析，修改渲染树，对页面进行回流和重绘</li>
<li><code>&lt;scirpt&gt;</code>所添加的脚本在执行完成之前，会阻塞后续的HTML进行解析。而如果通过src添加外链的方式来引入js脚本，那么在请求、下载、解析、运行所有过程完成之前，都不会进行后续HTML的解析</li>
<li>如果通过javascript添加script标签的方式加载，将会异步进行加载</li>
</ol>
<h2 id="第六题">第六题</h2>
<h3 id="题面-5">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/13.png" alt="第6题题面"></p>
<h3 id="解答-5">解答</h3>
<p>这题本来不难，一个下拉框，可以只用html+css实现，活用一下css的伪类就行了，至于那个小箭头用after伪元素画一下问题不大，代码如下，测试了一下能到IE7：</p>
<iframe width="100%" height="600" src="http://jsfiddle.net/skyinlayer/ZQ5Jd/1/embedded/result,css,html" allowfullscreen="allowfullscreen" frameborder="0">&nbsp;</iframe>

<p>但是底下的要求，直接让我吐血，支持IE6+…就这一句话得加多少乱七八糟的兼容….IE6不支持子元素选择器，去掉之。IE6没hover，去掉之。另外小箭头肯定不能用border画了，懒得弄图片了，补上js代码。结果如下：</p>
<iframe width="100%" height="600" src="http://jsfiddle.net/skyinlayer/ZQ5Jd/4/embedded/result,css,html" allowfullscreen="allowfullscreen" frameborder="0">&nbsp;</iframe>

<h2 id="第七题">第七题</h2>
<h3 id="题面-6">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/14.png" alt="第7题题面"></p>
<h3 id="解答-6">解答</h3>
<p>表单序列化，获取表单中的元素然后获取他们的值，拼接成字符串，挺有意思的一道题</p>
<p>通过form.elements可以获得所有的元素，顺序遍历一遍就好，需要注意的是checkbox和radio的checked状态，另外除了input以外，还有select和textarea（这里可能考虑不全）</p>
<pre><code class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">serialize</span><span class="params">(form)</span> {</span>
    <span class="keyword">var</span> params = [];
    <span class="keyword">var</span> elements = form.elements;
    <span class="keyword">var</span> i, m;
    <span class="keyword">var</span> input;
    <span class="keyword">for</span> (i = <span class="number">0</span>, m = elements.length; i &lt; m; i++) {
        input = elements[i];
        <span class="keyword">if</span> (input.tagName.toLowerCase() === <span class="string">"input"</span>) {
            <span class="keyword">switch</span> (input.type) {
                <span class="keyword">case</span> <span class="string">"radio"</span>:
                <span class="keyword">case</span> <span class="string">"checkbox"</span>:
                    <span class="keyword">if</span> (!input.checked) {
                        <span class="keyword">break</span>;
                    }
                <span class="keyword">default</span>:
                    <span class="keyword">if</span> (input.disabled == <span class="literal">false</span> &amp;&amp; input.name.length) {
                        params.push(<span class="built_in">encodeURI</span>(input.name) + <span class="string">"="</span> + <span class="built_in">encodeURI</span>(input.value));
                    }
            }
        } <span class="keyword">else</span> <span class="keyword">if</span> (input.tagName.toLowerCase() === <span class="string">"textarea"</span> || input.tagName.toLowerCase() === <span class="string">"select"</span>) {
            <span class="keyword">if</span> (input.disabled == <span class="literal">false</span> &amp;&amp; input.name.length) {
                params.push(<span class="built_in">encodeURI</span>(input.name) + <span class="string">"="</span> + <span class="built_in">encodeURI</span>(input.value));
            }
        }
    }
    <span class="keyword">return</span> params.join(<span class="string">"&amp;"</span>);
};
</code></pre>
<h2 id="第八题">第八题</h2>
<h3 id="题面-7">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/15.png" alt="第8题题面"></p>
<h3 id="解答-7">解答</h3>
<p>数组去重…这还只是扁平数组，不难，去哪儿那题是嵌套数组。不过它竟然要自己构造数组。去重的话直接用一个Object做标记就行。也可以考虑直接用indexOf判断，不过效率会降低</p>
<pre><code class="javascript"><span class="keyword">var</span> array = [];
<span class="keyword">var</span> i;

<span class="function"><span class="keyword">function</span> <span class="title">getRandomNumberString</span><span class="params">()</span> {</span>
    <span class="keyword">return</span> <span class="built_in">Math</span>.floor(<span class="built_in">Math</span>.random() * <span class="number">100</span>) + <span class="string">''</span>;
};

<span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) {
    array.push(getRandomNumberString());
}

<span class="function"><span class="keyword">function</span> <span class="title">unique</span><span class="params">(array)</span> {</span>
    <span class="keyword">var</span> result = [];
    <span class="keyword">var</span> uniObj = {};
    <span class="keyword">var</span> i, tmp;
    <span class="keyword">for</span> (i = array.length; i--;) {
        tmp = <span class="built_in">parseInt</span>(array[i]);
        <span class="keyword">if</span> (!uniObj[tmp]) {
            result.push(tmp);
            uniObj[tmp] = <span class="number">1</span>;
        }
    }
    <span class="keyword">return</span> result;
}

console.log(unique(array));
</code></pre>
<h2 id="第九题">第九题</h2>
<h3 id="题面-8">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/16.png" alt="第9题题面"></p>
<h3 id="解答-8">解答</h3>
<p>竟然会有这种题，好吧</p>
<p>第一个地方是浏览器嗅探。这里使用了无关属性<code>document.all</code>来嗅探IE，这样并不好。应该直接使用方法来嗅探，所以将其改为<code>window.attachEvent</code></p>
<p>第二个地方是事件对象未处理，我也是后来才知道的，自己只写了第一条就交了。这里由于老式IE对event和event.target不支持，所以需要进行兼容</p>
<p>第三个地方，记得提升变量申明</p>
<p>总体修改代码如下：</p>
<pre><code class="javascript"><span class="keyword">var</span> addListener;
<span class="keyword">if</span> (window.addEventListener) {
    addListener = <span class="function"><span class="keyword">function</span><span class="params">(el, type, listener, useCapture)</span> {</span>
        el.addEventListener(type, listener, useCapture);
    };
} <span class="keyword">else</span> <span class="keyword">if</span> (window.attachEvent) {
    addListener = <span class="function"><span class="keyword">function</span><span class="params">(el, type, listener)</span> {</span>
        el.attachEvent(<span class="string">"on"</span> + type, <span class="function"><span class="keyword">function</span><span class="params">(event)</span> {</span>
            event = event || window.event;
            event.target = event.target || event.srcElement;
            listener.apply(el, [event]);
        });
    };
}
</code></pre>
<h2 id="第十题">第十题</h2>
<h3 id="题面-9">题面</h3>
<p><img src="http://lingyu.wang/img/fe_interview/17.png" alt="第10题题面"></p>
<h3 id="解答-9">解答</h3>
<p>呵呵，还能不能愉快的答题了<code>(╯‵□′)╯︵┻━┻</code></p>
